# kube-mitm

Man-In-The-Middle proxy server, reporting all http/s requests to ELK stack, running in Kubernetes

# Installing

First up, get ELK up and running, you don't necessarily have to install this using the manifests here, it's probably available via Helm, Helm is good!

Once you have your ELK stack up, deploy mitm. The important part of this install is the config map, there you can see the plugin I wrote to forward json to ELK every time the proxy sees an HTTP req. Make sure the service name for logstash is correct and set to the correct port, in this case, it's "logstash-http"

# Quick note on certs

I am using JetStack's CertManager to manage certificates in K8s, the certificate manifest files assume you're doing the same, if you're not, use it, you won't regret it :-) 

# show-cert.sh

When mitm proxy first starts up, it should generate a CA cert and store it in the persistent volume (mitm-pvc.yml), this script is a two-liner that will show you the contents of that CA cert file, have any machine that you intend to use the proxy trust that CA and it will not question the authenticity of certs generated by mitm-proxy for https traffic!
